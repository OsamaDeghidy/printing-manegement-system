# وثيقة المواصفات التقنية النهائية والشاملة لمنصة الطباعة المتكاملة (الإصدار 3.1)


**الهدف:** توثيق جميع المتطلبات المعتمدة لمنصة الطباعة المتكاملة، بما في ذلك منطق الأعمال، سير العمل، نماذج البيانات، ونظام الصلاحيات، والهيكل التنظيمي للمطبعة، لتكون مرجعاً نهائياً للتطوير.

---

## 1. المبادئ الأساسية ونموذج الجهة (Entity-Based Model)

### 1.1 القاعدة الذهبية (Entity-Based Model)

القاعدة الأساسية المعتمدة هي أن **جميع الطلبات تُسجل على الجهة (Entity)** (الكلية، العمادة، الإدارة) وليس على الموظف الفردي.

*   **آلية العمل:**
    *   يُربط كل مستخدم بجهة واحدة (يُحدد من Active Directory).
    *   عند إنشاء طلب، يُسجل آلياً باسم الجهة.
    *   عند انتقال الموظف إلى إدارة أخرى، تبقى الطلبات السابقة للجهة الأصلية، مما يضمن استمرارية الملكية والمساءلة.

#### 1.1.1 الهيكلة الهرمية للجهات (Entity Hierarchy)

بناءً على هيكلة الجامعة، يجب أن يدعم النظام هيكلية هرمية للجهات (Entities) لتمكين التقارير والتحليلات على مستويات مختلفة.

| المستوى الهرمي | مثال على الجهة (Entity) | الوظيفة في النظام |
| :--- | :--- | :--- |
| **المستوى 1 (الأعلى)** | الوكالة/القطاع (Vice-Rectorate) | تجميعي للتقارير والتحليلات. |
| **المستوى 2 (المتوسط)** | الكلية/العمادة (College/Deanship) | الجهة الرئيسية لرفع الطلبات والمساءلة. |
| **المستوى 3 (الأدنى)** | القسم/الوحدة (Department/Unit) | أدنى مستوى يمكن أن يُرفع منه الطلب. |

**آلية تطبيق الهيكلية:**
*   يتم استيراد هذه الهيكلية من نظام Active Directory أو نظام الموارد البشرية.
*   يُسجل الطلب باسم الجهة في المستوى الأدنى (القسم/الوحدة) التابع لها المستخدم.
*   يتم ربط الطلب آلياً بالمستويات الأعلى (الكلية والوكالة) لغرض التقارير.
*   تُستخدم هذه الهيكلية في لوحة التقارير لتمكين مدير المطبعة من تصفية البيانات حسب الكلية أو الوكالة.

### 1.2 مرونة التحكم (Flexibility and Control)

يُمكن لمدير المطبعة التحكم الكامل في النظام من خلال لوحة الإعدادات، بما في ذلك:
*   إخفاء/إظهار أي حقل أو خدمة للمستخدمين.
*   تعديل خيارات القوائم المنسدلة.
*   تغيير إلزامية الحقول.



## 2. أدوار المستخدمين والصلاحيات (User Roles and Permissions)

| الدور | المسؤوليات الرئيسية | صلاحيات منطق الأعمال |
| :--- | :--- | :--- |
| **المستهلك (Consumer)** | رفع الطلبات، متابعة الحالة، حجز المواعيد، تقييم الخدمة. | **تأكيد الطلب** (خلال 72 ساعة)، **حجز تسليم/توصيل/زيارة**. |
| **مدير المطبعة (Print Manager)** | المراجعة الأولية، الإشراف العام، إدارة الإعدادات، **الإشراف على الصيانة والمخزون**. | **قبول/رفض/إلغاء/تعليق** أي طلب، **تحديد الأولوية**، **إدارة مواعيد الزيارات**. |
| **مدير القسم (Department Manager)** | الإشراف على القسم (تصميم/طباعة)، **متابعة الإنتاجية اليومية**. | **تعليق** الطلب فقط (لا يملك صلاحية الإلغاء)، متابعة الإنتاجية. |
| **موظف القسم (Department Employee)** | تنفيذ الطلبات، تحديث الحالة، إدخال الكميات المنفذة. | **تحديث حالة الطلب**، **إدخال الكمية الفعلية المنفذة** (لخصم المخزون). |
| **مشرف التدريب (Training Supervisor)** | إدارة طلبات التدريب التعاوني. | **قبول/رفض** طلبات التدريب، **التقييم الأسبوعي والنهائي**. |

### 2.1 الهيكل التنظيمي والوحدات التشغيلية (Organizational Structure and Operational Units)

تعتمد المنصة في سير عملها على الهيكل التنظيمي الفعلي للمطبعة، والذي ينعكس في مسارات سير العمل (Workflow) وتوزيع المهام. الوحدات الرئيسية هي:

| الوحدة التشغيلية | المسؤوليات الرئيسية (المنعكسة في النظام) |
| :--- | :--- |
| **وحدة التصميم والإخراج** | تصميم المطبوعات، ضمان الالتزام بالهوية البصرية، إعداد الملفات النهائية للطباعة، أرشفة التصاميم. |
| **وحدة الطباعة (أوفست/ديجيتال)** | تنفيذ الطباعة، الصيانة الدورية للآلات، تطبيق معايير الجودة والسلامة، أرشفة الملفات بعد الطباعة. |
| **وحدة الأسطح الطباعية (C.T.P)** | إعداد وتجهيز ألواح الطباعة (Plates)، حفظ الألواح والنماذج المكررة. |
| **وحدة القص والتجليد** | عمليات التجليد والقص والتجميع، تغليف المطبوعات النهائية. |
| **وحدة المستودعات** | إدارة المخزون (الورق، الأحبار، المواد الخام)، متابعة حركة المواد، الجرد السنوي. **(هذه الوحدة هي المسؤولة عن نظام المخزون في المنصة)**. |
| **وحدة الدعم الفني** | الإشراف على الأنظمة التقنية للمطبعة، أتمتة الإجراءات، تقديم الدعم الفني للموظفين. |

---

## 3. خدمة طلب التصميم (Design Service)

### 3.1 نموذج طلب تصميم جديد (DES-01)

| الحقل | النوع | الإلزامية | ملاحظات |
| :--- | :--- | :--- | :--- |
| `design_type` | قائمة | **✓** | بوستر، بروشور، كارت، شهادة، شعار، إلخ. |
| `title` | نص | **✓** | عنوان واضح (الحد الأقصى 200 حرف). |
| `size` | قائمة | **✓** | A0-A6 أو مخصص. |
| `description` | نص | **✓** | الهدف، الألوان المطلوبة، الرسالة. |
| `priority` | قائمة | **✓** | عادي، عاجل، طارئ. |
| `attachments` | ملفات | **—** | ملفات توضيحية (PDF, PNG, AI, PSD) بحد أقصى 25MB. |

### 3.2 سير عمل التصميم (Design Workflow)

1.  **PENDING_REVIEW:** مراجعة مدير المطبعة (قبول $\rightarrow$ `IN_DESIGN` / رفض $\rightarrow$ `REJECTED` / إرجاع $\rightarrow$ `RETURNED`).
2.  **IN_DESIGN:** تنفيذ موظف التصميم. يتم تفعيل خاصية حجز موعد للمستهلك للتناقش.
3.  **PENDING_CONFIRM:** **قاعدة الـ 72 ساعة:** يُرسل للمستهلك للتأكيد. إذا لم يؤكد خلال 72 ساعة، يُعلق الطلب آلياً (`SUSPENDED`).
4.  **COMPLETED:** بعد تأكيد المستهلك.

---

## 4. خدمة طلب الطباعة (Printing Service)

### 4.1 نموذج طلب الطباعة (PRT-01)

| الحقل | النوع | الإلزامية | ملاحظات |
| :--- | :--- | :--- | :--- |
| `print_type` | قائمة | **✓** | 13 نوعاً (كتب، كروت شخصية، بانرات، إلخ). |
| `production_dept` | قائمة | **✓** | أوفست، ديجيتال، GTO. |
| `size` | قائمة | **✓** | ISO 216 (A0-A7) أو مخصص. |
| `paper_type` | قائمة | **✓** | عادي، كوشيه، كرتون، شفاف، ستيكر. |
| `paper_weight` | قائمة | **✓** | 70g - 350g. |
| `quantity` | رقم | **✓** | الكمية المطلوبة (الحد الأدنى 1). |
| `file` | ملف | **شرطي** | **إلزامي** لـ "الكروت الشخصية" حتى لو كان المصدر طلب سابق. |
| `delivery_method` | قائمة | **✓** | استلام ذاتي، توصيل، توصيل + تركيب. |

### 4.2 سير عمل الطباعة (Printing Workflow)

1.  **PENDING_REVIEW:** مدير المطبعة يحدد الأولوية ويحيل للقسم المختص.
2.  **IN_PRODUCTION:** موظف القسم ينفذ العمل **ويدخل الكمية الفعلية المنفذة** (لخصم المخزون).
3.  **PENDING_CONFIRM:** قاعدة الـ 72 ساعة لتأكيد المستهلك.
4.  **IN_WAREHOUSE:** الطلب جاهز للتسليم. يتم تفعيل نموذج التسليم/التوصيل للمستهلك. **(هذه المرحلة تعكس دور وحدة المستودعات)**.
5.  **DELIVERY_SCHEDULED:** المستهلك حجز موعد التسليم/التوصيل.
6.  **ARCHIVED:** بعد تأكيد الاستلام النهائي من المستهلك أو الموصل.

---

## 5. نظام المخزون والخصم الآلي (Inventory and Automatic Deduction)

تم اعتماد نظام الخصم الآلي للمخزون لضمان دقة التقارير، وهو يعكس مهام **وحدة المستودعات**.

### 5.1 آلية الخصم الآلي

يتم الخصم آلياً من المخزون بناءً على الكمية الفعلية التي يدخلها موظف الطباعة عند إكمال الطلب.

*   **صيغة حساب الأوراق المستهلكة:**
    $$\text{إجمالي الأوراق} = (\text{عدد الأوجه} \times \text{عدد الصفحات}) \times \text{الكمية الفعلية المنفذة}$$

### 5.2 تنبيهات المخزون

*   يتم إرسال تنبيه داخلي لمدير المطبعة عند وصول كمية أي صنف إلى **الحد الأدنى للتنبيه** (`min_quantity`) المحدد في جدول المخزون.

---

## 6. خدمة حجز الزيارات (Visit Booking Service)

### 6.1 سير عمل الزيارات

*   **الزيارة الداخلية:** تقديم الطلب $\rightarrow$ مراجعة مدير المطبعة (قبول/رفض/تأجيل).
*   **الزيارة الخارجية:** تقديم الطلب + **إرفاق تصريح موقع ومختوم إلزامي** $\rightarrow$ مراجعة مدير المطبعة $\rightarrow$ مراجعة إدارة الأمن (اعتماد/رفض).

### 6.2 إدارة المواعيد (Business Logic)

*   **صلاحيات المدير:** مدير المطبعة يحدد الأيام المتاحة، يحجب أياماً كاملة (صيانة، إجازات)، ويخصص أياماً لأنواع معينة من الزيارات.
*   **منع التعارض:** يمنع النظام آلياً حجز مواعيد متضاربة.
*   **قاعدة التأخير:** يُلغى الموعد آلياً عند التأخير 10 دقائق عن الموعد المحدد.

---

## 7. نظام الإشعارات (Notifications System)

يتم إرسال الإشعارات داخلياً (In-App) وعبر البريد الإلكتروني (مع إمكانية تعطيل الإشعارات الخارجية من قبل المستخدم).

| الحدث (Trigger) | المستفيد (Recipient) | نوع الإشعار |
| :--- | :--- | :--- |
| **تجاوز مهلة التنفيذ** | مدير المطبعة، مدير القسم | تنبيه داخلي وإيميل |
| **قرب انتهاء مهلة الـ 72 ساعة** | المستهلك | تنبيه داخلي وإيميل (قبل 24 ساعة) |
| **بلط جاهز للتسليم** | المستهلك | تنبيه داخلي وإيميل (مع رابط حجز التسليم) |
| **انخفاض المخزون** | مدير المطبعة | تنبيه داخلي |
| **تغيير حالة الطلب** | المستهلك، المعنيون | تنبيه داخلي فوري |

---

## 8. هيكلة الصفحات (Routes)

| المسار (Route) | الدور المستهدف | الوصف الوظيفي |
| :--- | :--- | :--- |
| `/login` | جميع الأدوار | تسجيل الدخول الموحد (SSO) عبر Active Directory. |
| `/dashboard` | جميع الأدوار | لوحة معلومات مخصصة تعرض مؤشرات الأداء والإجراءات المطلوبة. |
| `/requests/new` | المستهلك | نموذج موحد لرفع طلبات الطباعة/التصميم. |
| `/visits` | المستهلك، المدير، الأمن | إدارة وحجز ومراجعة طلبات الزيارات. |
| `/admin/inventory` | مدير المطبعة | إدخال ومتابعة المخزون (مع خاصية الخصم الآلي). |
| `/admin/pricing` | مدير المطبعة | إدخال أسعار الخدمات (مخفية عن المستخدمين). |
| `/admin/reports` | مدير المطبعة | تقارير الطلبات، التوفير، الإنتاجية، المخزون. |
| `/admin/settings` | مدير المطبعة | التحكم الكامل في مرونة النظام (إخفاء/إظهار الحقول والخدمات). |

---

**ملاحظة أخيرة:** هذه الوثيقة هي المرجع النهائي المعتمد للتطوير. يجب على فريق العمل الالتزام التام بجميع القواعد المنطقية وسير العمل الموضح فيها.
